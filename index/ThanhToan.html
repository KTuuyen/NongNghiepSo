<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thanh To√°n - N√¥ng Nghi·ªáp S·ªë</title>
    <link rel="stylesheet" href="/css/style_ThanhToan.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-top">
            <div class="container">
                <div class="header-top-content">
                    <div><img src="../anh/MapPin.png" style="width: 15px; height: 18px; margin-right: 5px;"> CH·ªåN ƒê·ªäA ƒêI·ªÇM G·∫¶N B·∫†N</div>
                    <div>
                        <img src="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/flags/4x3/vn.svg" style="width: 16px; height: 12px; margin-right: 5px;"> VIE 
                        <svg width="12" height="12" style="margin-left: 5px;" fill="currentColor" viewBox="0 0 24 24"><path d="M7 10L12 15L17 10H7Z"/></svg>
                         CH√çNH S√ÅCH 
                        <svg width="12" height="12" style="margin-left: 5px;" fill="currentColor" viewBox="0 0 24 24"><path d="M7 10L12 15L17 10H7Z"/></svg>
                        |<a href="../index/DangKy.html"> ƒêƒÇNG K√ù</a> / <a href="../index/DangNhap.html">ƒêƒÇNG NH·∫¨P</a>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="header-main">
            <div class="container">
                <div class="header-content">
                    <div class="logo"><a href="../index/TrangChu.html"><img src="../anh/logo.png" alt="">N√îNG NGHI·ªÜP S·ªê</a></div>
                    
                    <div class="search-bar">
                        <input type="text" class="search-input" placeholder="T√¨m ki·∫øm...">
                        <button class="search-btn">Search</button>
                    </div>
                    
                    <div class="cart-info">
                        <a href="#" class="cart-item"><img src="../anh/Heart2.png" alt="">
                        </a> | <a href="#" class="cart-item"><img src="../anh/Bag.png" alt="">
                            <span class="cart-count">2</span></a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="container navbar-container">
            <ul class="menu">
                <li><a href="#" class="nav-item">TRANG CH·ª¶</a></li> 
                <li><a href="#" class="nav-item">S·∫¢N PH·∫®M</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle">MENU <img src="../anh/ChevronDown1.png" alt=""></a>
                    <ul class="dropdown-menu">
                        <li><a href="../DanhMuc/index/traicay.html">Tr√°i c√¢y</a></li>
                        <li><a href="../DanhMuc/index/rau.html">Rau c·ªß</a></li>
                        <li><a href="../DanhMuc/index/gao.html">G·∫°o</a></li>
                        <li><a href="../DanhMuc/index/thit.html">Th·ªãt</a></li>
                        <li><a href="../DanhMuc/index/ca.html">H·∫£i s·∫£n</a></li>
                        <li><a href="#">ƒê·ªì u·ªëng</a></li>
                        <li><a href="#">M·∫≠t ong</a></li>
                        <li><a href="#">Gia v·ªã</a></li>
                    </ul>
                </li>
                <li><a href="#" class="nav-item">TIN T·ª®C & S·ª∞ KI·ªÜN</a></li>
                
            </ul>
            <div class="navbar-icons">
                <i><img src="../anh/PhoneCall2.png" alt=""></i>
                <span>123456789</span>
            </div>
        </div>
    </nav>

    <!-- Breadcrumb -->
    <section class="breadcrumb">
        <div class="container">
            <div class="breadcrumb-content">
                <a href="/index/TrangChu.html"><img src="../anh/home-1.png" alt=""></a>
                <span >&gt;</span>
                <a href="#" class="current-page">GI·ªé H√ÄNG</a>
                <span>&gt;</span>
                <a href="/index/ThanhToan.html" class="current-page">THANH TO√ÅN</a>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <div class="checkout-container">
                <!-- Payment Form -->
                <div class="payment-form">
                    <h2 class="form-title">TH√îNG TIN THANH TO√ÅN</h2>
                    <form id="checkoutForm">
                        <div class="form-section">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">H·ªå</label>
                                    <input type="text" 
                                    id="first-name"class="form-input"  placeholder="First name">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">T√äN</label>
                                    <input type="text"
                                    id="last-name" class="form-input" placeholder="Last name">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">T√äN L√ìT</label>
                                    <input type="text" 
                                    id="middle-name" class="form-input" placeholder="Name">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">ƒê·ªäA CH·ªà NH√Ä</label>
                                <input type="text" id="address" class="form-input" placeholder="ƒê·ªãa ch·ªâ nh√†">
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">T·ªàNH/TH√ÄNH PH·ªê</label>
                                    <select id="province" class="form-select">
                                        <option>-- Ch·ªçn th√†nh ph·ªë --</option>
                                        <option>H√† N·ªôi</option>
                                        <option>TP. H·ªì Ch√≠ Minh</option>
                                        <option>ƒê√† N·∫µng</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">QU·ªêC GIA</label>
                                    <select id="countrySelect" class="form-select">
                                        <option>-- Ch·ªçn qu·ªëc gia --</option>
                                        <option>Vi·ªát Nam</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">QU·∫¨N/HUY·ªÜN</label>
                                    <select id="district" class="form-select">
                                        <option>-- Ch·ªçn Qu·∫≠n/Huy·ªán --</option>
                                        <option>Qu·∫≠n 1</option>
                                        <option>Qu·∫≠n 2</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Email</label>
                                    <input type="email" id="email" class="form-input" placeholder="Email Address">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">S·ªê ƒêI·ªÜN THO·∫†I</label>
                                    <input type="tel" id="phone" class="form-input" placeholder="Phone number">
                                </div>
                                <div></div>
                            </div>

                            <div class="checkbox-group">
                                <input type="checkbox" id="saveInfo" class="checkbox">
                                <label for="saveInfo"  id="agree-policy" class="checkbox-label">ƒê·ªíNG √ù V·ªöI CH√çNH S√ÅCH C·ª¶A CH√öNG T√îI</label>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 class="form-title">TH√îNG TIN B·ªî SUNG</h3>
                            <div class="form-group">
                                <label class="form-label">GHI CH√ö CHO NG∆Ø·ªúI GIAO H√ÄNG D·ªÑ T√åM B·∫†N H∆†N</label>
                                <textarea id="note" class="form-textarea" placeholder="Ghi ch√∫ cho ng∆∞·ªùi giao h√†ng..."></textarea>
                            </div>
                        </div>
                </div>
                <!-- Cart Summary -->
                <div class="cart-summary">
                    <h3 class="form-title">GI·ªé H√ÄNG C·ª¶A B·∫†N</h3>
                    <ul id="cart-list"></ul>
                    <br>
                    <p>T·ªîNG TI·ªÄN: <strong id="subtotal">...</strong> VNƒê</p>
                    <hr>
                    <p>PH√ç SHIP: <strong>Free</strong></p>
                    <hr>
                    <p>T·ªîNG ƒê∆†N H√ÄNG: <strong id="grandtotal">...</strong> VNƒê</p><br>
                    
                    <h3 class="form-title">H√åNH TH·ª®C THANH TO√ÅN</h3>
                    <div class="payment-method">
                        <label><input type="radio" name="payment" /> CHUY·ªÇN KHO·∫¢N NG√ÇN H√ÄNG</label>
                        <label><input type="radio" name="payment" /> MOMO</label>
                        <label><input type="radio" name="payment" /> TI·ªÄN M·∫∂T</label>
                    </div>
                    <button onclick="thanhtoan1()" class="checkout-button">THANH TO√ÅN</button>
                    <p id="result" style="color:red;"></p>
                    </div>
                </div>
            </div>
        </div>
        
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-brand">
                <div class="logo">
                    <a href="/index/TrangChu.html">
                        <img src="../anh/logo.png" alt="">
                        N√îNG NGHI·ªÜP S·ªê
                    </a>
                </div>
                <p>CHUY√äN CUNG C·∫§P RAU C·ª¶ - TR√ÅI C√ÇY - TH·ªäT T∆Ø∆†I <br> ƒê∆Ø·ª¢C PH√ÅT TRI·ªÇN V√Ä T·∫†O: N√îNG NGHI·ªÜP S·ªê</p>
            </div>
            
            <div class="footer-section">
                <h3>T√ÄI KHO·∫¢N</h3>
                <p><strong>EMAIL:</strong><br>hello2345@gmail.com</p>
                <p><strong>HOTLINE:</strong><br>123456789</p>
            </div>
            
            <div class="footer-section">
                <h3>H·ªñ TR·ª¢</h3>
                <p><a href="#">LI√äN H·ªÜ</a></p>
                <p><a href="#">C√ÇU H·ªéI TH∆Ø·ªúNG G·∫∂P</a></p>
                <p><a href="#">ƒêI·ªÄU KHO·∫¢N & QUY ƒê·ªäNH</a></p>
                <p><a href="#">CH√çNH S√ÅCH B·∫¢O M·∫¨T</a></p>
            </div>
        
        </div>
    </footer>
   
</body>
<script>
    window.onload = function () {
    fetch('../XuLy_php/info_thanhtoan.php')
        .then(res => res.json())
        .then(data => {
            if (data.status === 'success') {
                const { fullname, email, phone_number } = data.data;

                // T√°ch fullname th√†nh h·ªç, t√™n ƒë·ªám, t√™n
                const parts = fullname.trim().split(' ');
                document.getElementById('first-name').value = parts[0] || '';
                document.getElementById('middle-name').value = parts.slice(1, -1).join(' ') || '';
                document.getElementById('last-name').value = parts.slice(-1)[0] || '';

                document.getElementById('email').value = email || '';
                document.getElementById('phone').value = phone_number || '';
            } else {
                console.error('L·ªói:', data.message);
            }
        })
        .catch(err => {
            console.error('L·ªói khi g·ªçi API ng∆∞·ªùi d√πng:', err);
        });
    };
    // L·∫•y ph·∫ßn t·ª≠ select
    const provinceSelect = document.getElementById('province');
    const districtSelect = document.getElementById('district');

  // Load danh s√°ch t·ªânh/th√†nh
  fetch('https://provinces.open-api.vn/api/?depth=1')
    .then(res => res.json())
    .then(provinces => {
      provinces.forEach(p => {
        const option = document.createElement('option');
        option.value = p.code;
        option.textContent = p.name;
        provinceSelect.appendChild(option);
      });
    });

  // Khi ch·ªçn t·ªânh, load qu·∫≠n/huy·ªán
    provinceSelect.addEventListener('change', function () {
    const code = this.value;
    fetch(`https://provinces.open-api.vn/api/p/${code}?depth=2`)
      .then(res => res.json())
      .then(data => {
        districtSelect.innerHTML = '<option>Ch·ªçn qu·∫≠n/huy·ªán</option>';
        data.districts.forEach(d => {
          const option = document.createElement('option');
          option.value = d.code;
          option.textContent = d.name;
          districtSelect.appendChild(option);
        });
      });
  });

    //l·∫•y th√¥ng tin khi thanh to√°n
    function thanhtoan(){
      const ho = document.getElementById('first-name').value;
      const ten = document.getElementById('last-name').value;
      const tendem = document.getElementById('middle-name').value;
      const address=document.getElementById('address').value;
      const district=document.getElementById('district').value;
      const province=document.getElementById('province').value;
      const countrySelect=document.getElementById('countrySelect').value;
      const allStrong = document.querySelectorAll('.boxbill strong');
      const name=ho+' '+tendem+' '+ten
      const sdt = document.getElementById('phone').value;
      const email1 = document.getElementById('email').value;
      const addressFull=address+', '+district+', '+province+', '+countrySelect;
      const note=document.getElementById('note').value;
      const total_money=allStrong[2].innerText;
      fetch('../XuLy_php/ThanhToanLuu.php', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: new URLSearchParams({
          ten: name,
          sdt: sdt,
          email: email1,
          adress: addressFull,
          note: note,
          total: total_money
        })
      })
      .then(res => res.json())
      .then(data => {
          const resultEl = document.getElementById('result');
          console.log('Ph·∫£n h·ªìi JSON:', data); 
          if (data.status === 'success') {
            resultEl.style.color = 'green';
            resultEl.innerText = 'üéâ Thanh To√°n th√†nh c√¥ng!';
            setTimeout(() => {
              window.location.href = 'TrangChu.html'; // Chuy·ªÉn h∆∞·ªõng n·∫øu c·∫ßn
            }, 1000);
          } else {
            resultEl.style.color = 'red';
            resultEl.innerText = '‚ùå ' + data.message;
          }
        })
        .catch(err => {
          document.getElementById('result').innerText = 'L·ªói k·∫øt n·ªëi: ' + err;
        });
    }
    function submitForm() {
      const ho = document.getElementById('first-name').value;
      const ten = document.getElementById('last-name').value;
      const tendem = document.getElementById('middle-name').value;
      const sdt = document.getElementById('phone').value;
      const email = document.getElementById('email').value;
    
      fetch('../XuLy_php/thanhtoan.php', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: new URLSearchParams({
          ho: ho,
          tendem: tendem,
          ten: ten,
          stdtk: sdt,
          emaildk: email
      })
      })
      .then(res => res.json())  
      .then(response => {
        const resultEl = document.getElementById('result');
        console.log('Ph·∫£n h·ªìi:', response);
        resultEl.style.color = 'green';
        resultEl.innerText = response;
    
        if (response.includes("ghi nh·∫≠n")) {
          setTimeout(() => {
            window.location.href = 'TrangChu.html';
          }, 1000);
        }else {
          resultEl.style.color = 'red';
          resultEl.innerText = '‚ùå ' + data.message;
        }
      })
      .catch(err => {
        document.getElementById('result').innerText = '‚ùå L·ªói k·∫øt n·ªëi: ' + err;
      });
    }
     window.onload = function () {
      const cartList = document.getElementById('cart-list');
      const items = JSON.parse(localStorage.getItem('cart_items')) || [];
      const total = localStorage.getItem('cart_total') || "0";

      items.forEach(item => {
        const li = document.createElement('li');
        li.innerHTML = `
          <span>
            <img src="../anh/${item.name.includes("XANH") ? "otchuongxanh.jpg" : "otchuongdo.jpg"}" />
            ${item.name} x${item.quantity}
          </span>
          <span>${(item.price * item.quantity).toLocaleString('vi-VN')}</span>
        `;
        cartList.appendChild(li);
      });

      document.getElementById('subtotal').innerText = parseInt(total).toLocaleString('vi-VN');
      document.getElementById('grandtotal').innerText = parseInt(total).toLocaleString('vi-VN');
    };

    function thanhtoan1() {
      const payments = document.getElementsByName("payment");
      let selected = null;
      for (let p of payments) {
        if (p.checked) {
          selected = p.nextSibling.textContent.trim();
          break;
        }
      }

      if (!selected) {
        document.getElementById("result").innerText = "Vui l√≤ng ch·ªçn h√¨nh th·ª©c thanh to√°n!";
        return;
      }

      document.getElementById("result").style.color = "green";
      document.getElementById("result").innerText = "ƒê·∫∑t h√†ng th√†nh c√¥ng v·ªõi ph∆∞∆°ng th·ª©c: " + selected;

      // C√≥ th·ªÉ x√≥a localStorage n·∫øu c·∫ßn:
      // localStorage.removeItem("cart_items");
      // localStorage.removeItem("cart_total");
    }
</script>
    
</html>